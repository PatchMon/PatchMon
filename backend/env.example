# Database Configuration
DATABASE_URL="postgresql://patchmon_user:your-password-here@localhost:5432/patchmon_db"
PM_DB_CONN_MAX_ATTEMPTS=30
PM_DB_CONN_WAIT_INTERVAL=2

# Database Connection Pool Configuration (Prisma)
DB_CONNECTION_LIMIT=30       # Maximum connections per instance (default: 30)
DB_POOL_TIMEOUT=20          # Seconds to wait for available connection (default: 20)
DB_CONNECT_TIMEOUT=10       # Seconds to wait for initial connection (default: 10)
DB_IDLE_TIMEOUT=300         # Seconds before closing idle connections (default: 300)
DB_MAX_LIFETIME=1800        # Maximum lifetime of a connection in seconds (default: 1800)

# Database Transaction Timeout Configuration
DB_TRANSACTION_MAX_WAIT=10000    # Milliseconds to wait for transaction slot (default: 10000 = 10s)
DB_TRANSACTION_TIMEOUT=30000     # Milliseconds for transaction to complete (default: 30000 = 30s)
DB_TRANSACTION_LONG_TIMEOUT=60000 # Milliseconds for long-running transactions (default: 60000 = 60s)

# JWT Configuration
JWT_SECRET=your-secure-random-secret-key-change-this-in-production
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# Server Configuration
PORT=3001
NODE_ENV=production

# API Configuration
API_VERSION=v1

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# Session Configuration
SESSION_INACTIVITY_TIMEOUT_MINUTES=30

# User Configuration
DEFAULT_USER_ROLE=user

# Rate Limiting (times in milliseconds)
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=5000
AUTH_RATE_LIMIT_WINDOW_MS=600000
AUTH_RATE_LIMIT_MAX=500
AGENT_RATE_LIMIT_WINDOW_MS=60000
AGENT_RATE_LIMIT_MAX=1000

# Account Lockout Configuration
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15

# Password Complexity Configuration
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL=true

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_USER=your-redis-username-here
REDIS_PASSWORD=your-redis-password-here
REDIS_DB=0

# Redis Connection Timeouts (milliseconds)
# Increase these if you see "Command timed out" errors, especially with high network latency
# REDIS_CONNECT_TIMEOUT_MS=60000    # Time to wait for initial connection (default: 60s)
# REDIS_COMMAND_TIMEOUT_MS=60000    # Time to wait for Redis commands to complete (default: 60s)

# BullMQ Lock Configuration (milliseconds)
# These settings prevent "Missing lock" or "could not renew lock" errors when Redis is slow.
# lockDuration: How long a job can run before its lock expires (default: 120000 = 120s)
# lockRenewTime: How often to renew the lock to prevent expiration (default: 20000 = 20s)
# Increase lockDuration if you see lock expiration errors with long-running jobs
# Decrease lockRenewTime if lock renewals are timing out (must be < lockDuration and < REDIS_COMMAND_TIMEOUT_MS)
# BULLMQ_LOCK_DURATION_MS=120000
# BULLMQ_LOCK_RENEW_TIME_MS=20000

# Logging
# Set ENABLE_LOGGING=true (exactly "true") or the backend will not log at all.
# LOG_LEVEL: debug | info | warn | error (default: info)
# LOG_TO_CONSOLE=true: send logs to stdout/stderr (use this when viewing logs in Docker/systemd).
#   If unset in production, logs go only to logs/error.log and logs/combined.log.
LOG_LEVEL=info
ENABLE_LOGGING=true
# LOG_TO_CONSOLE=true

# TFA Configuration (optional - used if TFA is enabled)
TFA_REMEMBER_ME_EXPIRES_IN=30d
TFA_MAX_REMEMBER_SESSIONS=5
TFA_SUSPICIOUS_ACTIVITY_THRESHOLD=3

# TFA Rate Limiting (separate from login lockout)
MAX_TFA_ATTEMPTS=5
TFA_LOCKOUT_DURATION_MINUTES=30

# Timezone Configuration
# Set the timezone for timestamps and logs (e.g., 'UTC', 'America/New_York', 'Europe/London')
# Defaults to UTC if not set. This ensures consistent timezone handling across the application.
TZ=UTC

# ===================
# OIDC Configuration
# ===================
# Set to 'true' to enable OIDC authentication
OIDC_ENABLED=false

# OIDC Provider Discovery URL (ends with /.well-known/openid-configuration or the base issuer URL)
# For Authentik: https://auth.example.com/application/o/patchmon/
# For Keycloak: https://keycloak.example.com/realms/myrealm
OIDC_ISSUER_URL=

# Client credentials from your IdP
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=

# Redirect URI - must match what's configured in your IdP
OIDC_REDIRECT_URI=https://patchmon.example.com/api/v1/auth/oidc/callback

# Scopes to request (space-separated)
# Include 'groups' scope if using group-based role mapping
OIDC_SCOPES=openid email profile groups

# Auto-create users on first OIDC login
OIDC_AUTO_CREATE_USERS=true

# Default role for auto-created users: 'admin' or 'user'
OIDC_DEFAULT_ROLE=user

# Optional: Disable local password authentication entirely
OIDC_DISABLE_LOCAL_AUTH=false

# Optional: Button text for the SSO login button
OIDC_BUTTON_TEXT=Login with SSO

# ===================
# OIDC Group Mapping
# ===================
# Map IdP groups to PatchMon roles
# Users in OIDC_ADMIN_GROUP get 'admin' role
# Users in OIDC_USER_GROUP get 'user' role
# Users in neither get OIDC_DEFAULT_ROLE
OIDC_ADMIN_GROUP=PatchMon Admins
OIDC_USER_GROUP=PatchMon Users

# Sync roles on every login (set to 'true' to update role based on current groups)
# When false, role is only set on first login
OIDC_SYNC_ROLES=true
